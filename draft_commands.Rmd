packages needed
```{r}
install.packages("ridigbio")
install.packages("dplyr")
install.packages("knitr")
install.packages("kableExtra")
webshot::install_phantomjs()
```
```{r}
library(ridigbio)
library(dplyr)
library(knitr)
library(kableExtra)
```

-------------------------------------------------------------------------------
Use of function???
(How to include Rank(type closure??) into argumentation?)
(temporarily functions are split into taxonomic ranks)
```{r}  
# Order level search
source("./function_final_project.R")
collection_order("Phacopida")
```  

```{r}  
# Family level search
source("./function_final_project.R")
collection_family("Phacopidae")
```  

```{r}  
# Genus level search
source("./function_final_project.R")
collection_genus("Acernaspis")
```  


------------------------------------------------------------------------
[experiments]

taxa list comparison
```{r}
source("./function_final_project.R")
compare_taxa_genus(Taxon = "Acernaspis", Path = "./mytaxa.txt")
```

```{r}
compare_taxa_genus <- function (Taxon, Path) {
  data <- idig_search_records(rq=list(genus=Taxon), fields = "all")
  col_needed <- c("institutioncode", "catalognumber", "order", "family", "genus", "specificepithet", "earliestperiodorlowestsystem", "latestperiodorhighestsystem", "country", "county", "stateprovince", "formation")
  data_selected <- select(data, col_needed)

  inst_code_list <- unique(data_selected$institutioncode)
  as.vector(inst_code_list)

  data_selected_vector <- c()
  for (code in 1:length(inst_code_list)){
    data_fortab <- data_selected
    inst_code <- inst_code_list[code]
    
    data_fortab <- data_selected[data_selected$institutioncode==inst_code, ]
    data_fortab$institutioncode <- NULL
    data_selected_vector <- c(data_selected_vector, list(data_fortab))
  }

  MyTaxa <- read.delim(file = Path, header = FALSE, sep = "", col.names = c("Genus", "species"))

  for (obj in 1:length(data_selected_vector)){
    UnCodedSp_vector <- data_selected_vector[[obj]][["specificepithet"]] %in% MyTaxa$species
    UnCodedSp_row <- which(UnCodedSp_vector==FALSE)
    print(kable(data_selected_vector[[obj]], format = "html", col.names = c("ColID", "Order", "Fam", "Gen", "Sp.", "eAge", "lAge", "Country", "County", "State", "Fm."), align = "l") %>%
    kable_styling(bootstrap_options = "striped", full_width = F) %>%
    row_spec(UnCodedSp_row, color = "red"))
    cat("\n")
# What does the cat("\n") mean? (https://stackoverflow.com/questions/39650166/r-why-kable-doesnt-print-inside-a-for-loop)
  }
}
```


# sorting
```{r}
data <- idig_search_records(rq=list(genus="Acernaspis"), fields = "all")
data_sorted <- data[order(data$institutioncode),]
head(data_sorted, n=10)
```

# this works
```{r}
data <- idig_search_records(rq=list(genus="Acernaspis"), fields = "all")

# extract neccessarycolumns.
col_needed <- c("institutioncode", "catalognumber", "order", "family", "genus", "specificepithet", "earliestperiodorlowestsystem", "latestperiodorhighestsystem", "country", "county", "stateprovince", "formation")
data_selected <- select(data, col_needed)

# make a list of institution codes.
# convert it into a vector
inst_code_list <- unique(data_selected$institutioncode)
as.vector(inst_code_list)

# for loop to make a table for each institution
# delete institution code
# make a table (Huge!!)
data_fortab <- data_selected
data_fortab$institutioncode <- NULL
kable(data_fortab, format = "html", col.names = c("ColID", "Order", "Fam", "Gen", "Sp.", "eAge", "lAge", "Country", "County", "State", "Fm."), align = "l")
```



# this works with problem (in pdf.) May be it's not good to output as PDF.
```{r}
dataframe_list <- list()
for (i in 1:length(inst_code_list)){
  data_fortab <- data_selected
  inst_code <- inst_code_list[i]
  
  data_fortab <- data_selected[data_selected$institutioncode==inst_code, ]
  data_fortab$institutioncode <- NULL
  dataframe_list <- append(dataframe_list, list(data_fortab))
  names(dataframe_list)[i] <- paste0("data_fortab",i)
}

kable(dataframe_list, format = "html", col.names = c("ColID", "Order", "Fam", "Gen", "Sp.", "eAge", "lAge", "Country", "County", "State", "Fm."), align = "l") %>%
  kable_styling("striped") %>%
  save_kable("./table.pdf")
```




How about paleobioDB's tool to map paleo map?
```{r}
install.packages("paleobioDB")
```
```{r}
library(paleobioDB)
```


? authorship??


Error!
```{r}
install.packages("devtools")
library(devtools)
```

